<div class="analytics-container">
  <div class="header-section">
    <h2 class="page-title">Business Analytics</h2>
    <div class="actions">
      <button class="btn btn-outline-primary" (click)="shareReport()">
        <i class="fas fa-share-alt"></i>
        Share Report
      </button>
      <button class="btn btn-outline-primary" (click)="downloadDashboard()">
        <i class="fas fa-download"></i>
        Download
      </button>
      <button class="btn btn-primary" (click)="optimizeOperations()">
        <i class="fas fa-chart-line"></i>
        Optimize
      </button>
    </div>
  </div>

  <!-- Period Selector -->
  <div class="period-selector">
    <button 
      class="period-btn" 
      [class.active]="selectedPeriod === '7days'"
      (click)="setPeriod('7days')">
      Last 7 Days
    </button>
    <button 
      class="period-btn" 
      [class.active]="selectedPeriod === '30days'"
      (click)="setPeriod('30days')">
      Last 30 Days
    </button>
    <button 
      class="period-btn" 
      [class.active]="selectedPeriod === '90days'"
      (click)="setPeriod('90days')">
      Last 90 Days
    </button>
    <button 
      class="period-btn" 
      [class.active]="selectedPeriod === '1year'"
      (click)="setPeriod('1year')">
      This Year
    </button>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'overview'"
      (click)="setActiveTab('overview')">
      <i class="fas fa-tachometer-alt"></i>
      Overview
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'trips'"
      (click)="setActiveTab('trips')">
      <i class="fas fa-route"></i>
      Trip Analytics
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'customers'"
      (click)="setActiveTab('customers')">
      <i class="fas fa-users"></i>
      Customers
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'financial'"
      (click)="setActiveTab('financial')">
      <i class="fas fa-chart-pie"></i>
      Financial
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'operational'"
      (click)="setActiveTab('operational')">
      <i class="fas fa-cogs"></i>
      Operations
    </button>
  </div>

  <!-- Overview Tab -->
  <div class="tab-content" *ngIf="activeTab === 'overview'">
    <!-- Key Performance Metrics -->
    <div class="kpi-grid">
      <div class="kpi-card revenue">
        <div class="kpi-header">
          <div class="kpi-title">Total Revenue</div>
          <div class="kpi-icon">
            <i class="fas fa-rupee-sign"></i>
          </div>
        </div>
        <div class="kpi-value">{{ formatCurrency(performanceMetrics.totalRevenue) }}</div>
        <div class="kpi-trend">
          <i class="fas fa-arrow-up trend-up"></i>
          <span>12.5% vs last period</span>
        </div>
      </div>

      <div class="kpi-card trips">
        <div class="kpi-header">
          <div class="kpi-title">Total Trips</div>
          <div class="kpi-icon">
            <i class="fas fa-car"></i>
          </div>
        </div>
        <div class="kpi-value">{{ performanceMetrics.totalTrips }}</div>
        <div class="kpi-trend">
          <i class="fas fa-arrow-up trend-up"></i>
          <span>8.2% vs last period</span>
        </div>
      </div>

      <div class="kpi-card satisfaction">
        <div class="kpi-header">
          <div class="kpi-title">Customer Satisfaction</div>
          <div class="kpi-icon">
            <i class="fas fa-star"></i>
          </div>
        </div>
        <div class="kpi-value">{{ performanceMetrics.customerSatisfaction }}/5</div>
        <div class="kpi-trend">
          <i class="fas fa-arrow-up trend-up"></i>
          <span>0.2 pts improvement</span>
        </div>
      </div>

      <div class="kpi-card efficiency">
        <div class="kpi-header">
          <div class="kpi-title">Fleet Utilization</div>
          <div class="kpi-icon">
            <i class="fas fa-percentage"></i>
          </div>
        </div>
        <div class="kpi-value">{{ performanceMetrics.vehicleUtilization }}%</div>
        <div class="kpi-trend">
          <i class="fas fa-arrow-down trend-down"></i>
          <span>2.1% vs last period</span>
        </div>
      </div>
    </div>

    <!-- Performance Overview Grid -->
    <div class="performance-overview">
      <div class="performance-card">
        <h3>Operational Metrics</h3>
        <div class="metrics-list">
          <div class="metric-item">
            <div class="metric-info">
              <span class="metric-label">Driver Efficiency</span>
              <span class="metric-value">{{ performanceMetrics.driverEfficiency }}%</span>
            </div>
            <div class="metric-bar">
              <div class="bar-fill" [style.width.%]="performanceMetrics.driverEfficiency" 
                   [style.background-color]="getPerformanceColor(performanceMetrics.driverEfficiency, 85)"></div>
            </div>
          </div>

          <div class="metric-item">
            <div class="metric-info">
              <span class="metric-label">On-Time Performance</span>
              <span class="metric-value">{{ performanceMetrics.onTimePercentage }}%</span>
            </div>
            <div class="metric-bar">
              <div class="bar-fill" [style.width.%]="performanceMetrics.onTimePercentage"
                   [style.background-color]="getPerformanceColor(performanceMetrics.onTimePercentage, 90)"></div>
            </div>
          </div>

          <div class="metric-item">
            <div class="metric-info">
              <span class="metric-label">Fuel Efficiency</span>
              <span class="metric-value">{{ performanceMetrics.fuelEfficiency }} km/l</span>
            </div>
            <div class="metric-bar">
              <div class="bar-fill" [style.width.%]="(performanceMetrics.fuelEfficiency / 20) * 100"
                   [style.background-color]="getPerformanceColor(performanceMetrics.fuelEfficiency, 12)"></div>
            </div>
          </div>

          <div class="metric-item">
            <div class="metric-info">
              <span class="metric-label">Repeat Customer Rate</span>
              <span class="metric-value">{{ performanceMetrics.repeatCustomerRate }}%</span>
            </div>
            <div class="metric-bar">
              <div class="bar-fill" [style.width.%]="performanceMetrics.repeatCustomerRate"
                   [style.background-color]="getPerformanceColor(performanceMetrics.repeatCustomerRate, 60)"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="performance-card">
        <h3>Financial Overview</h3>
        <div class="financial-summary">
          <div class="summary-item gross">
            <div class="summary-value">{{ formatCurrency(financialAnalytics.profitMargins.gross) }}</div>
            <div class="summary-label">Gross Revenue</div>
          </div>
          <div class="summary-item expenses">
            <div class="summary-value">{{ formatCurrency(financialAnalytics.profitMargins.expenses) }}</div>
            <div class="summary-label">Total Expenses</div>
          </div>
          <div class="summary-item profit">
            <div class="summary-value">{{ formatCurrency(financialAnalytics.profitMargins.netProfit) }}</div>
            <div class="summary-label">Net Profit</div>
          </div>
          <div class="profit-margin">
            <div class="margin-label">Profit Margin</div>
            <div class="margin-value">{{ financialAnalytics.profitMargins.marginPercentage }}%</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Trip Analytics Tab -->
  <div class="tab-content" *ngIf="activeTab === 'trips'">
    <div class="analytics-grid">
      <!-- Peak Hours Analysis -->
      <div class="analytics-card">
        <h3>Peak Hours Analysis</h3>
        <div class="peak-hours-chart">
          <div class="hour-bar" *ngFor="let hour of tripAnalytics.peakHours">
            <div class="hour-info">
              <span class="hour-label">{{ hour.hour }}</span>
              <span class="hour-trips">{{ hour.trips }} trips</span>
            </div>
            <div class="hour-bar-container">
              <div class="hour-bar-fill" [style.width.%]="(hour.trips / 60) * 100"></div>
            </div>
            <span class="hour-revenue">{{ formatCurrency(hour.revenue) }}</span>
          </div>
        </div>
      </div>

      <!-- Popular Routes -->
      <div class="analytics-card">
        <h3>Top Routes</h3>
        <div class="routes-list">
          <div class="route-item" *ngFor="let route of tripAnalytics.popularRoutes; let i = index">
            <div class="route-rank">{{ i + 1 }}</div>
            <div class="route-details">
              <div class="route-name">{{ route.route }}</div>
              <div class="route-stats">
                <span class="stat">{{ route.trips }} trips</span>
                <span class="stat">{{ route.avgDuration }} avg</span>
              </div>
            </div>
            <div class="route-revenue">{{ formatCurrency(route.revenue) }}</div>
          </div>
        </div>
      </div>

      <!-- Distance Distribution -->
      <div class="analytics-card full-width">
        <h3>Distance Distribution</h3>
        <div class="distance-chart">
          <div class="distance-segment" *ngFor="let segment of tripAnalytics.distanceDistribution">
            <div class="segment-header">
              <span class="segment-range">{{ segment.range }}</span>
              <span class="segment-percentage">{{ segment.percentage }}%</span>
            </div>
            <div class="segment-bar">
              <div class="segment-fill" [style.width.%]="segment.percentage"></div>
            </div>
            <div class="segment-stats">
              <span class="segment-trips">{{ segment.trips }} trips</span>
              <span class="segment-fare">{{ formatCurrency(segment.avgFare) }} avg fare</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Customer Analytics Tab -->
  <div class="tab-content" *ngIf="activeTab === 'customers'">
    <div class="analytics-grid">
      <!-- Customer Demographics -->
      <div class="analytics-card">
        <h3>Customer Demographics</h3>
        <div class="demographics-chart">
          <div class="demo-item" *ngFor="let demo of customerAnalytics.demographics">
            <div class="demo-header">
              <span class="demo-type">{{ demo.type }}</span>
              <span class="demo-percentage">{{ demo.percentage }}%</span>
            </div>
            <div class="demo-stats">
              <div class="demo-stat">
                <span class="stat-label">Customers</span>
                <span class="stat-value">{{ demo.count }}</span>
              </div>
              <div class="demo-stat">
                <span class="stat-label">Avg Spend</span>
                <span class="stat-value">{{ formatCurrency(demo.avgSpend) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loyalty Segments -->
      <div class="analytics-card">
        <h3>Customer Loyalty</h3>
        <div class="loyalty-segments">
          <div class="loyalty-item" *ngFor="let segment of customerAnalytics.loyaltySegments">
            <div class="loyalty-header">
              <span class="loyalty-segment">{{ segment.segment }}</span>
              <span class="loyalty-count">{{ segment.count }} customers</span>
            </div>
            <div class="loyalty-revenue">{{ formatCurrency(segment.revenue) }}</div>
            <div class="loyalty-bar">
              <div class="loyalty-fill" [style.width.%]="segment.percentage"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Satisfaction Trends -->
      <div class="analytics-card full-width">
        <h3>Customer Satisfaction Trends</h3>
        <div class="satisfaction-chart">
          <div class="satisfaction-item" *ngFor="let trend of customerAnalytics.satisfactionTrends">
            <div class="trend-period">{{ trend.period }}</div>
            <div class="trend-rating" [style.color]="getRatingColor(trend.rating)">
              {{ trend.rating }}/5
            </div>
            <div class="trend-responses">{{ trend.responses }} responses</div>
            <div class="rating-stars">
              <i class="fas fa-star" *ngFor="let star of [1,2,3,4,5]" 
                 [class.filled]="star <= trend.rating"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Financial Tab -->
  <div class="tab-content" *ngIf="activeTab === 'financial'">
    <div class="analytics-grid">
      <!-- Revenue Breakdown -->
      <div class="analytics-card">
        <h3>Revenue Sources</h3>
        <div class="revenue-breakdown">
          <div class="revenue-item" *ngFor="let source of financialAnalytics.revenueBreakdown">
            <div class="revenue-info">
              <span class="revenue-source">{{ source.source }}</span>
              <span class="revenue-amount">{{ formatCurrency(source.amount) }}</span>
            </div>
            <div class="revenue-bar">
              <div class="revenue-fill" [style.width.%]="source.percentage"></div>
            </div>
            <span class="revenue-percentage">{{ source.percentage }}%</span>
          </div>
        </div>
      </div>

      <!-- Cost Analysis -->
      <div class="analytics-card">
        <h3>Cost Breakdown</h3>
        <div class="cost-analysis">
          <div class="cost-item" *ngFor="let cost of financialAnalytics.costAnalysis">
            <div class="cost-info">
              <span class="cost-category">{{ cost.category }}</span>
              <span class="cost-amount">{{ formatCurrency(cost.amount) }}</span>
            </div>
            <div class="cost-bar">
              <div class="cost-fill" [style.width.%]="cost.percentage"></div>
            </div>
            <span class="cost-percentage">{{ cost.percentage }}%</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Operational Tab -->
  <div class="tab-content" *ngIf="activeTab === 'operational'">
    <div class="analytics-grid">
      <!-- Fleet Utilization -->
      <div class="analytics-card">
        <h3>Fleet Utilization</h3>
        <div class="fleet-metrics">
          <div class="fleet-item" *ngFor="let vehicle of operationalMetrics.fleetUtilization">
            <div class="vehicle-header">
              <span class="vehicle-plate">{{ vehicle.vehicle }}</span>
              <span class="utilization-badge" 
                    [style.background-color]="getUtilizationColor(vehicle.utilization)">
                {{ vehicle.utilization }}%
              </span>
            </div>
            <div class="vehicle-stats">
              <div class="vehicle-stat">
                <span class="stat-label">Trips</span>
                <span class="stat-value">{{ vehicle.trips }}</span>
              </div>
              <div class="vehicle-stat">
                <span class="stat-label">Revenue</span>
                <span class="stat-value">{{ formatCurrency(vehicle.revenue) }}</span>
              </div>
              <div class="vehicle-stat">
                <span class="stat-label">Downtime</span>
                <span class="stat-value">{{ vehicle.downtime }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Driver Performance -->
      <div class="analytics-card">
        <h3>Driver Performance</h3>
        <div class="driver-metrics">
          <div class="driver-item" *ngFor="let driver of operationalMetrics.driverPerformance">
            <div class="driver-header">
              <span class="driver-name">{{ driver.driver }}</span>
              <span class="driver-rating" [style.color]="getRatingColor(driver.rating)">
                {{ driver.rating }}/5
              </span>
            </div>
            <div class="driver-stats">
              <div class="driver-stat">
                <span class="stat-label">Trips</span>
                <span class="stat-value">{{ driver.trips }}</span>
              </div>
              <div class="driver-stat">
                <span class="stat-label">Earnings</span>
                <span class="stat-value">{{ formatCurrency(driver.earnings) }}</span>
              </div>
              <div class="driver-stat">
                <span class="stat-label">Efficiency</span>
                <span class="stat-value">{{ driver.efficiency }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>