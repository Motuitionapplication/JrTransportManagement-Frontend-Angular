<div class="tracking-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-left">
      <h2 class="page-title">Real-Time Tracking</h2>
      <div class="tracking-status">
        <div class="status-indicator" [class.active]="isTracking">
          <i class="fas fa-circle"></i>
        </div>
        <span class="status-text">{{ isTracking ? 'Live Tracking' : 'Tracking Paused' }}</span>
        <span class="update-interval">Updates every {{ updateInterval }}s</span>
      </div>
    </div>

    <div class="header-actions">
      <div class="tracking-controls">
        <button class="control-btn" (click)="toggleTracking()" [class.active]="isTracking">
          <i [class]="isTracking ? 'fas fa-pause' : 'fas fa-play'"></i>
          {{ isTracking ? 'Pause' : 'Start' }}
        </button>
        
        <select class="interval-select" [(ngModel)]="updateInterval" (change)="setUpdateInterval(updateInterval)">
          <option value="10">10s</option>
          <option value="30">30s</option>
          <option value="60">1min</option>
          <option value="300">5min</option>
        </select>
      </div>

      <div class="view-controls">
        <button class="view-btn" [class.active]="viewMode === 'fleet'" (click)="viewMode = 'fleet'">
          <i class="fas fa-th"></i>
          Fleet View
        </button>
        <button class="view-btn" [class.active]="viewMode === 'routes'" (click)="viewMode = 'routes'">
          <i class="fas fa-route"></i>
          Routes
        </button>
      </div>

      <button class="btn btn-primary" (click)="exportTrackingData()">
        <i class="fas fa-download"></i>
        Export Data
      </button>
    </div>
  </div>

  <!-- Statistics Bar -->
  <div class="stats-bar">
    <div class="stat-card active-vehicles">
      <div class="stat-icon">
        <i class="fas fa-car"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ trackingStats.activeVehicles }}</div>
        <div class="stat-label">Active Vehicles</div>
      </div>
    </div>

    <div class="stat-card ongoing-trips">
      <div class="stat-icon">
        <i class="fas fa-route"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ trackingStats.ongoingTrips }}</div>
        <div class="stat-label">Ongoing Trips</div>
      </div>
    </div>

    <div class="stat-card alerts">
      <div class="stat-icon" [class.alert]="trackingStats.alertCount > 0">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ trackingStats.alertCount }}</div>
        <div class="stat-label">Active Alerts</div>
      </div>
    </div>

    <div class="stat-card avg-speed">
      <div class="stat-icon">
        <i class="fas fa-tachometer-alt"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ trackingStats.averageSpeed | number:'1.1-1' }}</div>
        <div class="stat-label">Avg Speed (km/h)</div>
      </div>
    </div>

    <div class="stat-card distance">
      <div class="stat-icon">
        <i class="fas fa-road"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ trackingStats.totalDistance | number:'1.1-1' }}</div>
        <div class="stat-label">Total Distance (km)</div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar Navigation -->
      <div class="sidebar-nav">
        <button class="nav-btn" [class.active]="sidebarMode === 'vehicles'" (click)="setSidebarMode('vehicles')">
          <i class="fas fa-car"></i>
          Vehicles ({{ getFilteredVehicles().length }})
        </button>
        <button class="nav-btn" [class.active]="sidebarMode === 'routes'" (click)="setSidebarMode('routes')">
          <i class="fas fa-route"></i>
          Routes ({{ routes.length }})
        </button>
        <button class="nav-btn" [class.active]="sidebarMode === 'alerts'" (click)="setSidebarMode('alerts')">
          <i class="fas fa-bell"></i>
          Alerts ({{ getFilteredAlerts().length }})
        </button>
        <button class="nav-btn" [class.active]="sidebarMode === 'zones'" (click)="setSidebarMode('zones')">
          <i class="fas fa-map-marked-alt"></i>
          Zones ({{ geofenceZones.length }})
        </button>
      </div>

      <!-- Vehicles Panel -->
      <div class="sidebar-content" *ngIf="sidebarMode === 'vehicles'">
        <div class="panel-header">
          <h3>Fleet Status</h3>
          <div class="filter-controls">
            <select class="filter-select" [(ngModel)]="vehicleStatusFilter" (change)="setVehicleStatusFilter(vehicleStatusFilter)">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="idle">Idle</option>
              <option value="offline">Offline</option>
              <option value="maintenance">Maintenance</option>
            </select>
          </div>
        </div>

        <div class="vehicles-list">
          <div class="vehicle-item" 
               *ngFor="let vehicle of getFilteredVehicles()"
               [class.selected]="selectedVehicle?.vehicleId === vehicle.vehicleId"
               (click)="selectVehicle(vehicle)">
            
            <div class="vehicle-header">
              <div class="vehicle-info">
                <div class="vehicle-plate">{{ vehicle.vehiclePlate }}</div>
                <div class="driver-name">{{ vehicle.driverName }}</div>
              </div>
              <div class="vehicle-status">
                <span class="status-badge" [style.background-color]="getVehicleStatusColor(vehicle.status)">
                  {{ vehicle.status | titlecase }}
                </span>
              </div>
            </div>

            <div class="vehicle-details">
              <div class="detail-row">
                <span class="detail-label">
                  <i class="fas fa-tachometer-alt"></i>
                  Speed
                </span>
                <span class="detail-value">{{ vehicle.speed }} km/h</span>
              </div>

              <div class="detail-row">
                <span class="detail-label">
                  <i class="fas fa-clock"></i>
                  Last Update
                </span>
                <span class="detail-value">{{ formatTimestamp(vehicle.lastUpdate) }}</span>
              </div>

              <div class="detail-row" *ngIf="vehicle.fuelLevel !== undefined">
                <span class="detail-label">
                  <i class="fas fa-gas-pump"></i>
                  Fuel
                </span>
                <span class="detail-value">{{ vehicle.fuelLevel }}%</span>
              </div>

              <div class="detail-row" *ngIf="vehicle.batteryLevel !== undefined">
                <span class="detail-label">
                  <i class="fas fa-battery-three-quarters"></i>
                  Battery
                </span>
                <span class="detail-value">{{ vehicle.batteryLevel }}%</span>
              </div>
            </div>

            <div class="current-booking" *ngIf="vehicle.currentBooking">
              <div class="booking-header">
                <i class="fas fa-user"></i>
                <span class="customer-name">{{ vehicle.currentBooking.customerName }}</span>
              </div>
              <div class="booking-route">
                <div class="route-point">
                  <i class="fas fa-circle pickup"></i>
                  {{ vehicle.currentBooking.pickup }}
                </div>
                <div class="route-point">
                  <i class="fas fa-map-marker-alt destination"></i>
                  {{ vehicle.currentBooking.destination }}
                </div>
              </div>
              <div class="booking-eta">
                <i class="fas fa-clock"></i>
                ETA: {{ formatETA(vehicle.currentBooking.eta) }}
              </div>
            </div>

            <div class="vehicle-actions">
              <button class="action-btn" (click)="centerMapOnVehicle(vehicle); $event.stopPropagation()">
                <i class="fas fa-crosshairs"></i>
              </button>
              <button class="action-btn" (click)="callDriver(vehicle.vehicleId); $event.stopPropagation()">
                <i class="fas fa-phone"></i>
              </button>
              <button class="action-btn emergency" (click)="sendEmergencyAlert(vehicle.vehicleId); $event.stopPropagation()">
                <i class="fas fa-exclamation"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Routes Panel -->
      <div class="sidebar-content" *ngIf="sidebarMode === 'routes'">
        <div class="panel-header">
          <h3>Active Routes</h3>
        </div>

        <div class="routes-list">
          <div class="route-item" 
               *ngFor="let route of routes"
               [class.selected]="selectedRoute?.bookingId === route.bookingId"
               (click)="selectRoute(route)">
            
            <div class="route-header">
              <div class="booking-id">{{ route.bookingId }}</div>
              <span class="route-status" [class]="route.status">{{ route.status | titlecase }}</span>
            </div>

            <div class="route-progress">
              <div class="progress-info">
                <span class="distance">{{ route.actualDistance || 0 }}/{{ route.estimatedDistance }} km</span>
                <span class="duration">{{ route.estimatedDuration }} min est.</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" 
                     [style.width.%]="((route.actualDistance || 0) / route.estimatedDistance) * 100"></div>
              </div>
            </div>

            <div class="route-waypoints">
              <div class="waypoint" *ngFor="let waypoint of route.waypoints">
                <i [class]="waypoint.type === 'pickup' ? 'fas fa-circle pickup' : 
                            waypoint.type === 'destination' ? 'fas fa-map-marker-alt destination' : 
                            'fas fa-circle waypoint'"></i>
                <span class="waypoint-address">{{ waypoint.address || 'Waypoint' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Alerts Panel -->
      <div class="sidebar-content" *ngIf="sidebarMode === 'alerts'">
        <div class="panel-header">
          <h3>Tracking Alerts</h3>
          <div class="alert-controls">
            <select class="filter-select" [(ngModel)]="alertSeverityFilter" (change)="setAlertSeverityFilter(alertSeverityFilter)">
              <option value="all">All Severity</option>
              <option value="critical">Critical</option>
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
            <button class="btn btn-sm btn-outline-primary" (click)="acknowledgeAllAlerts()">
              <i class="fas fa-check-double"></i>
              Ack All
            </button>
          </div>
        </div>

        <div class="alerts-list">
          <div class="alert-item" 
               *ngFor="let alert of getFilteredAlerts()"
               [class.acknowledged]="alert.acknowledged"
               [class]="alert.severity">
            
            <div class="alert-header">
              <div class="alert-icon" [style.color]="getAlertSeverityColor(alert.severity)">
                <i [class]="getAlertIcon(alert.type)"></i>
              </div>
              <div class="alert-info">
                <div class="alert-vehicle">{{ alert.vehiclePlate }} - {{ alert.driverName }}</div>
                <div class="alert-time">{{ formatTimestamp(alert.timestamp) }}</div>
              </div>
              <div class="severity-badge" [style.background-color]="getAlertSeverityColor(alert.severity)">
                {{ alert.severity | titlecase }}
              </div>
            </div>

            <div class="alert-message">{{ alert.message }}</div>

            <div class="alert-location">
              <i class="fas fa-map-marker-alt"></i>
              {{ alert.location.address }}
            </div>

            <div class="alert-actions" *ngIf="!alert.acknowledged">
              <button class="btn btn-sm btn-outline-success" (click)="acknowledgeAlert(alert.id)">
                <i class="fas fa-check"></i>
                Acknowledge
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="dismissAlert(alert.id)">
                <i class="fas fa-times"></i>
                Dismiss
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Geofence Zones Panel -->
      <div class="sidebar-content" *ngIf="sidebarMode === 'zones'">
        <div class="panel-header">
          <h3>Geofence Zones</h3>
          <div class="zone-controls">
            <label class="toggle-control">
              <input type="checkbox" [(ngModel)]="showGeofences">
              <span class="toggle-label">Show on Map</span>
            </label>
          </div>
        </div>

        <div class="zones-list">
          <div class="zone-item" *ngFor="let zone of geofenceZones">
            <div class="zone-header">
              <div class="zone-info">
                <div class="zone-name">{{ zone.name }}</div>
                <div class="zone-type">{{ zone.type | titlecase }}</div>
              </div>
              <label class="zone-toggle">
                <input type="checkbox" [checked]="zone.active" (change)="toggleGeofenceZone(zone.id)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="zone-details">
              <div class="zone-detail">
                <i class="fas fa-bell"></i>
                <span>Alerts: {{ zone.alerts ? 'Enabled' : 'Disabled' }}</span>
              </div>
              <div class="zone-detail" *ngIf="zone.radius">
                <i class="fas fa-circle"></i>
                <span>Radius: {{ zone.radius }}m</span>
              </div>
              <div class="zone-detail" *ngIf="!zone.radius">
                <i class="fas fa-draw-polygon"></i>
                <span>Points: {{ zone.coordinates.length }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Map Container -->
    <div class="map-container">
      <div class="map-controls">
        <div class="map-style-controls">
          <button class="map-control-btn" [class.active]="mapStyle === 'roadmap'" (click)="changeMapStyle('roadmap')">
            <i class="fas fa-map"></i>
            Road
          </button>
          <button class="map-control-btn" [class.active]="mapStyle === 'satellite'" (click)="changeMapStyle('satellite')">
            <i class="fas fa-satellite"></i>
            Satellite
          </button>
          <button class="map-control-btn" [class.active]="mapStyle === 'terrain'" (click)="changeMapStyle('terrain')">
            <i class="fas fa-mountain"></i>
            Terrain
          </button>
        </div>

        <div class="map-options">
          <label class="map-option">
            <input type="checkbox" [(ngModel)]="showTraffic">
            <span>Show Traffic</span>
          </label>
          <label class="map-option">
            <input type="checkbox" [(ngModel)]="showGeofences">
            <span>Show Zones</span>
          </label>
        </div>

        <div class="map-actions">
          <button class="map-action-btn" (click)="resetMapView()">
            <i class="fas fa-home"></i>
            Reset View
          </button>
          <button class="map-action-btn" *ngIf="selectedVehicle" (click)="deselectVehicle()">
            <i class="fas fa-times"></i>
            Clear Selection
          </button>
        </div>
      </div>

      <!-- Map Placeholder (In real implementation, replace with actual map component) -->
      <div class="map-placeholder">
        <div class="map-center-info">
          <h4>Map View</h4>
          <p>Center: {{ mapCenter.lat | number:'1.4-4' }}, {{ mapCenter.lng | number:'1.4-4' }}</p>
          <p>Zoom: {{ mapZoom }}</p>
          <p>Style: {{ mapStyle | titlecase }}</p>
          
          <div class="map-legend" *ngIf="viewMode === 'fleet'">
            <h5>Vehicle Status</h5>
            <div class="legend-item">
              <div class="legend-color" style="background: #10b981;"></div>
              <span>Active</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #f59e0b;"></div>
              <span>Idle</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #64748b;"></div>
              <span>Offline</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #ef4444;"></div>
              <span>Maintenance</span>
            </div>
          </div>

          <!-- Vehicle markers simulation -->
          <div class="vehicle-markers" *ngIf="viewMode === 'fleet'">
            <div class="marker" *ngFor="let vehicle of getFilteredVehicles()" 
                 [style.color]="getVehicleStatusColor(vehicle.status)"
                 [class.selected]="selectedVehicle?.vehicleId === vehicle.vehicleId">
              <i [class]="getVehicleIcon(vehicle)"></i>
              <span class="marker-label">{{ vehicle.vehiclePlate }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>