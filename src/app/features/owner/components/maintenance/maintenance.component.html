<div class="container-fluid">
  <!-- Title Row -->
  <div class="title-row">
    <div class="title-container">
      <div class="header-icon">
        <i class="fas fa-tools"></i>
      </div>
      <h2 class="header-title">Service Center Maintenance</h2>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon blue">
        <i class="fas fa-clipboard-list"></i>
      </div>
      <div class="stat-details">
        <h3>{{ maintenanceStats.totalRecords }}</h3>
        <p>Total Records</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon red">
        <i class="fas fa-rupee-sign"></i>
      </div>
      <div class="stat-details">
        <h3>₹{{ maintenanceStats.totalCost | number:'1.0-0' }}</h3>
        <p>Total Cost</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon green">
        <i class="fas fa-calendar-check"></i>
      </div>
      <div class="stat-details">
        <h3>{{ maintenanceStats.thisMonthRecords }}</h3>
        <p>This Month</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon orange">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="stat-details">
        <h3>₹{{ maintenanceStats.thisMonthCost | number:'1.0-0' }}</h3>
        <p>Month Cost</p>
      </div>
    </div>
  </div>

  <!-- Controls Row -->
  <div class="controls-row">
    <div class="controls-container">
      <div class="filters-section">
        <!-- Search Input -->
        <div class="filter-group">
          <input
            type="text"
            class="search-input"
            placeholder="Search maintenance records..."
            [(ngModel)]="searchValue"
            (input)="onQuickFilterChanged()"
          />
        </div>

        <!-- Vehicle Filter -->
        <div class="filter-group">
          <select class="form-select filter-select" [(ngModel)]="selectedVehicle" (change)="onQuickFilterChanged()">
            <option value="">All Vehicles</option>
            <option *ngFor="let vehicle of availableVehicles" [value]="vehicle.vehicleNumber">
              {{ vehicle.vehicleNumber }}
            </option>
          </select>
        </div>

        <!-- Type Filter -->
        <div class="filter-group">
          <select class="form-select filter-select" [(ngModel)]="selectedType" (change)="onQuickFilterChanged()">
            <option value="">All Types</option>
            <option *ngFor="let type of maintenanceTypes" [value]="type">
              {{ type.replace('_', ' ') }}
            </option>
          </select>
        </div>
      </div>

      <div class="buttons-section">
        <button class="action-btn btn-warning" (click)="exportToCSV()">
          <i class="fas fa-download"></i>
          Export
        </button>

        <button class="action-btn btn-success" (click)="openMaintenanceModal()">
          <i class="fas fa-plus"></i>
          Add Maintenance
        </button>
      </div>
    </div>
  </div>

  <!-- Maintenance Form Modal -->
  <div *ngIf="showMaintenanceModal" class="form-modal-overlay">
    <div class="modal-container maintenance-modal">
      <!-- Modal Header -->
      <div class="modal-header">
        <div class="modal-title-section">
          <div class="modal-icon">
            <i class="fas fa-tools"></i>
          </div>
          <h3 class="modal-title">
            {{ isEditMode ? 'Edit Maintenance Record' : 'Add New Maintenance Record' }}
          </h3>
        </div>
        <button class="close-btn" (click)="closeMaintenanceModal()" type="button">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <form [formGroup]="maintenanceForm" class="maintenance-form">
          <!-- Section 1: Vehicle & Service Center -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="fas fa-truck"></i>
              Vehicle & Service Center
            </h4>
            <div class="form-grid">
              <!-- Vehicle Selection -->
              <div class="form-field">
                <label class="form-label">
                  Vehicle <span class="required">*</span>
                </label>
                <select formControlName="vehicleId" class="form-select">
                  <option value="">Select Vehicle</option>
                  <option *ngFor="let vehicle of availableVehicles" [value]="vehicle.id">
                    {{ vehicle.vehicleNumber }} - {{ vehicle.manufacturer }} {{ vehicle.model }}
                  </option>
                </select>
                <div
                  class="error-message"
                  *ngIf="maintenanceForm.get('vehicleId')?.invalid && 
                         maintenanceForm.get('vehicleId')?.touched"
                >
                  <i class="fas fa-exclamation-circle"></i>
                  Please select a vehicle
                </div>
              </div>

              <!-- Service Center -->
              <div class="form-field">
                <label class="form-label">
                  Service Center <span class="required">*</span>
                </label>
                <select formControlName="serviceCenterId" class="form-select">
                  <option value="">Select Service Center</option>
                  <option *ngFor="let center of serviceCenterOptions" [value]="center">
                    {{ center }}
                  </option>
                </select>
                <div
                  class="error-message"
                  *ngIf="maintenanceForm.get('serviceCenterId')?.invalid && 
                         maintenanceForm.get('serviceCenterId')?.touched"
                >
                  <i class="fas fa-exclamation-circle"></i>
                  Please select a service center
                </div>
              </div>
            </div>
          </div>

          <!-- Section 2: Service Details -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="fas fa-cog"></i>
              Service Details
            </h4>
            <div class="form-grid">
              <!-- Service Type -->
              <div class="form-field">
                <label class="form-label">
                  Service Type <span class="required">*</span>
                </label>
                <select formControlName="type" class="form-select">
                  <option value="">Select Type</option>
                  <option *ngFor="let type of maintenanceTypes" [value]="type">
                    {{ type.replace('_', ' ') }}
                  </option>
                </select>
                <div
                  class="error-message"
                  *ngIf="maintenanceForm.get('type')?.invalid && 
                         maintenanceForm.get('type')?.touched"
                >
                  <i class="fas fa-exclamation-circle"></i>
                  Please select a service type
                </div>
              </div>

              <!-- Service Date -->
              <div class="form-field">
                <label class="form-label">
                  Service Date <span class="required">*</span>
                </label>
                <input
                  type="date"
                  formControlName="serviceDate"
                  class="form-input"
                  [max]="getCurrentDate()"
                />
                <div
                  class="error-message"
                  *ngIf="maintenanceForm.get('serviceDate')?.invalid && 
                         maintenanceForm.get('serviceDate')?.touched"
                >
                  <i class="fas fa-exclamation-circle"></i>
                  Please select service date
                </div>
              </div>

              <!-- Cost -->
              <div class="form-field">
                <label class="form-label">
                  Cost (₹) <span class="required">*</span>
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-rupee-sign input-icon"></i>
                  <input
                    type="number"
                    formControlName="cost"
                    placeholder="5000.00"
                    min="0"
                    step="0.01"
                    class="form-input with-icon"
                  />
                </div>
                <div
                  class="error-message"
                  *ngIf="maintenanceForm.get('cost')?.invalid && 
                         maintenanceForm.get('cost')?.touched"
                >
                  <i class="fas fa-exclamation-circle"></i>
                  Please enter a valid cost
                </div>
              </div>

              <!-- Receipt URL -->
              <div class="form-field">
                <label class="form-label">
                  Receipt URL
                  <span class="optional-label">(Optional)</span>
                </label>
                <div class="input-with-icon">
                  <i class="fas fa-file-invoice input-icon"></i>
                  <input
                    type="text"
                    formControlName="receipt"
                    placeholder="https://example.com/receipt.pdf"
                    class="form-input with-icon"
                  />
                </div>
                <small class="form-hint">
                  <i class="fas fa-info-circle"></i>
                  Provide a link to the receipt document
                </small>
              </div>
            </div>
          </div>

          <!-- Section 3: Description -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="fas fa-align-left"></i>
              Service Description
            </h4>
            <div class="form-field full-width">
              <label class="form-label">
                Description <span class="required">*</span>
              </label>
              <textarea
                formControlName="description"
                rows="4"
                placeholder="Detailed description of maintenance work performed (e.g., Oil change with Mobil 1 synthetic oil, replaced oil filter, checked all fluid levels, inspected brake pads - 60% remaining)"
                class="form-textarea"
                maxlength="255"
              ></textarea>
              <div class="character-count">
                {{ maintenanceForm.get('description')?.value?.length || 0 }} / 255 characters
              </div>
              <div
                class="error-message"
                *ngIf="maintenanceForm.get('description')?.invalid && 
                       maintenanceForm.get('description')?.touched"
              >
                <i class="fas fa-exclamation-circle"></i>
                Description is required (maximum 255 characters)
              </div>
            </div>
          </div>

          <!-- Form Summary (for edit mode) -->
          <div *ngIf="isEditMode" class="form-summary">
            <i class="fas fa-info-circle"></i>
            <span>Editing existing maintenance record</span>
          </div>
        </form>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeMaintenanceModal()"
          [disabled]="isSaving"
        >
          <i class="fas fa-times"></i>
          Cancel
        </button>

        <button
          type="button"
          class="btn btn-success"
          (click)="onSubmitMaintenanceForm()"
          [disabled]="isSaving || maintenanceForm.invalid"
        >
          <i class="fas fa-spinner fa-spin" *ngIf="isSaving"></i>
          <i class="fas fa-save" *ngIf="!isSaving"></i>
          <span *ngIf="isSaving">Saving...</span>
          <span *ngIf="!isSaving">{{ isEditMode ? 'Update Record' : 'Save Record' }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Grid Section -->
  <div class="grid-wrapper">
    <div class="grid-header">
      <h3 class="grid-title">
        <i class="fas fa-list"></i>
        Maintenance Records
      </h3>
      <div class="grid-info">
        <span class="record-count">
          <i class="fas fa-database"></i>
          {{ maintenanceRecords.length }} Records
        </span>
      </div>
    </div>

    <div class="grid-container-with-padding">
      <div class="grid-container">
        <ag-grid-angular
          class="ag-theme-alpine"
          [rowData]="maintenanceRecords"
          [columnDefs]="columnDefs"
          [defaultColDef]="defaultColDef"
          [gridOptions]="gridOptions"
          (gridReady)="onGridReady($event)"
          style="height: 100%; width: 100%"
        >
        </ag-grid-angular>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="isLoadingMaintenance" class="loading-overlay">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Loading maintenance records...</p>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoadingMaintenance && maintenanceRecords.length === 0" class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-clipboard-list"></i>
    </div>
    <h3>No Maintenance Records Found</h3>
    <p>Get started by adding your first maintenance record</p>
    <button class="btn btn-primary" (click)="openMaintenanceModal()">
      <i class="fas fa-plus"></i>
      Add First Record
    </button>
  </div>

  <!-- Custom Alert -->
  <div
    *ngIf="showMessage"
    class="custom-alert"
    [ngClass]="{
      'alert-success': !isErrorMessage,
      'alert-error': isErrorMessage
    }"
  >
    <div class="alert-content">
      <div class="alert-icon">
        <i
          class="fas"
          [ngClass]="{
            'fa-check-circle': !isErrorMessage,
            'fa-exclamation-circle': isErrorMessage
          }"
        ></i>
      </div>
      <span class="alert-message">{{ alertMessage }}</span>
      <button class="alert-close" (click)="showMessage = false">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="alert-progress" [class.error]="isErrorMessage"></div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteConfirm" class="modal-overlay confirmation-overlay">
    <div class="confirmation-modal">
      <div class="confirmation-header">
        <div class="confirmation-icon danger">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3>Confirm Delete</h3>
      </div>
      <div class="confirmation-body">
        <p>Are you sure you want to delete this maintenance record?</p>
        <p class="warning-text">
          <i class="fas fa-info-circle"></i>
          This action cannot be undone.
        </p>
      </div>
      <div class="confirmation-footer">
        <button class="btn btn-secondary" (click)="cancelDelete()">
          <i class="fas fa-times"></i>
          Cancel
        </button>
        <button class="btn btn-danger" (click)="confirmDelete()">
          <i class="fas fa-trash"></i>
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
