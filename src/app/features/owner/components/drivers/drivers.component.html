<div class="drivers-container">
  <div class="header-section">
    <h2 class="page-title">Driver Management</h2>
    <div class="actions">
      <button class="btn btn-outline-primary" (click)="exportDriverList()">
        <i class="fas fa-download"></i>
        Export List
      </button>
      <button class="btn btn-primary" (click)="addNewDriver()">
        <i class="fas fa-user-plus"></i>
        Add Driver
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-number">{{ driverStats.total }}</div>
        <div class="stat-label">Total Drivers</div>
      </div>
      <div class="stat-icon total">
        <i class="fas fa-users"></i>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-number">{{ driverStats.active }}</div>
        <div class="stat-label">Active Drivers</div>
      </div>
      <div class="stat-icon active">
        <i class="fas fa-user-check"></i>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-number">{{ driverStats.online }}</div>
        <div class="stat-label">Currently Online</div>
      </div>
      <div class="stat-icon online">
        <i class="fas fa-circle"></i>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-number">{{ driverStats.suspended }}</div>
        <div class="stat-label">Suspended</div>
      </div>
      <div class="stat-icon suspended">
        <i class="fas fa-user-times"></i>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-number">{{ driverStats.documentsExpiring }}</div>
        <div class="stat-label">Documents Expiring</div>
      </div>
      <div class="stat-icon expiring">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
    </div>
  </div>

  <!-- Search and Filter -->
  <div class="search-filter-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Search drivers by name, phone, license, or vehicle..."
        [(ngModel)]="searchTerm"
        class="form-control">
    </div>
    
    <div class="filter-dropdown">
      <select [(ngModel)]="statusFilter" class="form-select">
        <option value="all">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
        <option value="suspended">Suspended</option>
      </select>
    </div>
  </div>

  <!-- Drivers List -->
  <div class="drivers-list">
    <div class="driver-card" *ngFor="let driver of filteredDrivers">
      <div class="driver-header">
        <div class="driver-basic-info">
          <div class="profile-section">
            <div class="profile-image">
              <img *ngIf="driver.profileImage; else defaultAvatar" [src]="driver.profileImage" [alt]="driver.name">
              <ng-template #defaultAvatar>
                <div class="default-avatar">{{ driver.name.charAt(0) }}</div>
              </ng-template>
            </div>
            <div class="online-indicator" [class.online]="driver.isOnline"></div>
          </div>
          
          <div class="driver-details">
            <div class="driver-name">{{ driver.name }}</div>
            <div class="driver-contact">
              <i class="fas fa-phone"></i>
              {{ driver.phone }}
            </div>
            <div class="driver-license">
              <i class="fas fa-id-card"></i>
              {{ driver.licenseNumber }}
            </div>
          </div>
        </div>

        <div class="driver-status-section">
          <span 
            class="status-badge" 
            [style.background-color]="getStatusColor(driver.status)">
            {{ driver.status | titlecase }}
          </span>
          <div class="rating-section">
            <div class="rating-stars">
              <i class="fas fa-star" *ngFor="let star of [1,2,3,4,5]" 
                 [class.filled]="star <= driver.rating"></i>
            </div>
            <span class="rating-value">{{ driver.rating }}/5</span>
          </div>
        </div>
      </div>

      <div class="driver-body">
        <div class="info-grid">
          <div class="info-section">
            <h4>Trip Statistics</h4>
            <div class="stats-row">
              <div class="stat-item">
                <span class="stat-value">{{ driver.totalTrips }}</span>
                <span class="stat-label">Total Trips</span>
              </div>
              <div class="stat-item">
                <span class="stat-value">{{ driver.completedTrips }}</span>
                <span class="stat-label">Completed</span>
              </div>
              <div class="stat-item">
                <span class="stat-value">{{ driver.cancelledTrips }}</span>
                <span class="stat-label">Cancelled</span>
              </div>
              <div class="stat-item">
                <span class="stat-value">{{ formatCurrency(driver.totalEarnings) }}</span>
                <span class="stat-label">Total Earnings</span>
              </div>
            </div>
          </div>

          <div class="info-section">
            <h4>Performance Metrics</h4>
            <div class="performance-metrics">
              <div class="metric-item">
                <div class="metric-label">On-Time %</div>
                <div class="metric-progress">
                  <div class="progress-bar">
                    <div 
                      class="progress-fill" 
                      [style.width.%]="driver.performance.onTimePercentage"
                      [style.background-color]="getPerformanceColor(driver.performance.onTimePercentage)">
                    </div>
                  </div>
                  <span class="metric-value">{{ driver.performance.onTimePercentage }}%</span>
                </div>
              </div>

              <div class="metric-item">
                <div class="metric-label">Safety Score</div>
                <div class="metric-progress">
                  <div class="progress-bar">
                    <div 
                      class="progress-fill" 
                      [style.width.%]="driver.performance.safetyScore"
                      [style.background-color]="getPerformanceColor(driver.performance.safetyScore)">
                    </div>
                  </div>
                  <span class="metric-value">{{ driver.performance.safetyScore }}%</span>
                </div>
              </div>

              <div class="metric-item">
                <div class="metric-label">Fuel Efficiency</div>
                <div class="metric-progress">
                  <div class="progress-bar">
                    <div 
                      class="progress-fill" 
                      [style.width.%]="driver.performance.fuelEfficiency"
                      [style.background-color]="getPerformanceColor(driver.performance.fuelEfficiency)">
                    </div>
                  </div>
                  <span class="metric-value">{{ driver.performance.fuelEfficiency }}%</span>
                </div>
              </div>
            </div>
          </div>

          <div class="info-section">
            <h4>Current Assignment</h4>
            <div class="assignment-info">
              <div class="vehicle-info" *ngIf="driver.currentVehicle; else noVehicle">
                <i class="fas fa-car"></i>
                <span>{{ driver.currentVehicle }}</span>
              </div>
              <ng-template #noVehicle>
                <div class="no-vehicle">
                  <i class="fas fa-car-slash"></i>
                  <span>No vehicle assigned</span>
                </div>
              </ng-template>
              
              <div class="last-active">
                <i class="fas fa-clock"></i>
                Last Active: {{ driver.lastActive | date:'MMM dd, HH:mm' }}
              </div>
            </div>
          </div>

          <div class="info-section">
            <h4>Document Status</h4>
            <div class="documents-status">
              <span 
                class="document-badge" 
                [style.background-color]="getDocumentStatusColor(getDocumentStatus(driver.documents))">
                {{ getDocumentStatus(driver.documents) | titlecase }}
              </span>
              <div class="documents-expiry" *ngIf="hasExpiringDocuments(driver)">
                <i class="fas fa-exclamation-triangle"></i>
                Documents expiring soon
              </div>
            </div>
          </div>
        </div>

        <div class="suspension-info" *ngIf="driver.status === 'suspended' && driver.suspensionReason">
          <div class="suspension-alert">
            <i class="fas fa-ban"></i>
            <strong>Suspension Reason:</strong> {{ driver.suspensionReason }}
          </div>
        </div>
      </div>

      <div class="driver-actions">
        <button 
          class="action-btn view-btn" 
          (click)="viewDriverProfile(driver.id)"
          title="View Profile">
          <i class="fas fa-eye"></i>
        </button>
        
        <button 
          class="action-btn edit-btn" 
          (click)="editDriver(driver.id)"
          title="Edit Driver">
          <i class="fas fa-edit"></i>
        </button>

        <button 
          class="action-btn assign-btn" 
          (click)="assignVehicle(driver.id)"
          title="Assign Vehicle"
          *ngIf="!driver.currentVehicle && driver.status === 'active'">
          <i class="fas fa-car"></i>
        </button>

        <button 
          class="action-btn track-btn" 
          (click)="trackDriver(driver.id)"
          title="Track Location"
          *ngIf="driver.isOnline">
          <i class="fas fa-map-marker-alt"></i>
        </button>

        <button 
          class="action-btn contact-btn" 
          (click)="contactDriver(driver.phone)"
          title="Contact Driver">
          <i class="fas fa-phone"></i>
        </button>

        <button 
          class="action-btn documents-btn" 
          (click)="viewDocuments(driver.id)"
          title="View Documents">
          <i class="fas fa-folder"></i>
        </button>

        <div class="dropdown">
          <button class="action-btn more-btn dropdown-toggle" data-bs-toggle="dropdown">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <ul class="dropdown-menu">
            <li *ngIf="driver.status === 'active'">
              <a class="dropdown-item text-warning" (click)="suspendDriver(driver.id)">
                <i class="fas fa-ban"></i> Suspend Driver
              </a>
            </li>
            <li *ngIf="driver.status === 'suspended'">
              <a class="dropdown-item text-success" (click)="activateDriver(driver.id)">
                <i class="fas fa-check"></i> Activate Driver
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item" (click)="viewDriverProfile(driver.id)">
                <i class="fas fa-user"></i> View Full Profile
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="no-drivers" *ngIf="filteredDrivers.length === 0">
      <i class="fas fa-users-slash"></i>
      <h3>No drivers found</h3>
      <p>No drivers match your current search and filter criteria.</p>
      <button class="btn btn-primary" (click)="addNewDriver()">
        <i class="fas fa-user-plus"></i>
        Add First Driver
      </button>
    </div>
  </div>
</div>