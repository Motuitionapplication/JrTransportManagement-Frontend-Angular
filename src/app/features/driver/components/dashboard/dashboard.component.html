<div class="dashboard-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Driver Dashboard</h1>
      <p class="page-subtitle">Welcome back! Here's your overview</p>
    </div>
    <div class="header-actions">
      <button 
        type="button" 
        class="btn btn-outline-primary"
        (click)="refreshDashboard()"
        [disabled]="isLoading">
        <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
        Refresh
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-section">
    <div class="stats-grid mb-4">
      <!-- Total Bookings -->
      <div class="stat-card stat-primary" role="group">
        <div class="stat-card-body">
          <div class="stat-content">
            <div class="stat-top">
              <div class="stat-icon">
                <i class="fas fa-clipboard-list"></i>
              </div>
              <div class="stat-value" *ngIf="!statsLoading">{{ stats.totalBookings }}</div>
              <div class="stat-loading" *ngIf="statsLoading">
                <div class="spinner-border spinner-border-sm"></div>
              </div>
            </div>
            <div class="stat-label">Total Bookings</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i> +8% this month
            </div>
          </div>
        </div>
      </div>

      <!-- Completed Trips -->
      <div class="stat-card stat-success" role="group">
        <div class="stat-card-body">
          <div class="stat-content">
            <div class="stat-top">
              <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="stat-value" *ngIf="!statsLoading">{{ stats.completedTrips }}</div>
              <div class="stat-loading" *ngIf="statsLoading">
                <div class="spinner-border spinner-border-sm"></div>
              </div>
            </div>
            <div class="stat-label">Completed Trips</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i> {{ getCompletionRate() }}% completion rate
            </div>
          </div>
        </div>
      </div>

      <!-- Pending Trips -->
      <div class="stat-card stat-warning" role="group">
        <div class="stat-card-body">
          <div class="stat-content">
            <div class="stat-top">
              <div class="stat-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-value" *ngIf="!statsLoading">{{ stats.pendingTrips }}</div>
              <div class="stat-loading" *ngIf="statsLoading">
                <div class="spinner-border spinner-border-sm"></div>
              </div>
            </div>
            <div class="stat-label">Pending Trips</div>
            <div class="stat-change neutral">
              <i class="fas fa-minus"></i> Needs attention
            </div>
          </div>
        </div>
      </div>

      <!-- Total Earnings -->
      <div class="stat-card stat-info" role="group">
        <div class="stat-card-body">
          <div class="stat-content">
            <div class="stat-top">
              <div class="stat-icon">
                <i class="fas fa-rupee-sign"></i>
              </div>
              <div class="stat-value" *ngIf="!statsLoading">{{ formatCurrency(stats.totalEarnings) }}</div>
              <div class="stat-loading" *ngIf="statsLoading">
                <div class="spinner-border spinner-border-sm"></div>
              </div>
            </div>
            <div class="stat-label">Total Earnings</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i> +{{ getEarningsGrowth() }}% this month
            </div>
          </div>
        </div>
      </div>

      <!-- This Month Earnings -->
      <div class="stat-card stat-secondary" role="group">
        <div class="stat-card-body">
          <div class="stat-content">
            <div class="stat-top">
              <div class="stat-icon">
                <i class="fas fa-calendar-month"></i>
              </div>
              <div class="stat-value" *ngIf="!statsLoading">{{ formatCurrency(stats.thisMonthEarnings) }}</div>
              <div class="stat-loading" *ngIf="statsLoading">
                <div class="spinner-border spinner-border-sm"></div>
              </div>
            </div>
            <div class="stat-label">This Month</div>
          </div>
        </div>
      </div>

      <!-- Average Rating -->
      <div class="stat-card stat-success" role="group">
        <div class="stat-card-body">
          <div class="stat-content">
            <div class="stat-top">
              <div class="stat-icon">
                <i class="fas fa-star"></i>
              </div>
              <div class="stat-value" *ngIf="!statsLoading">{{ stats.averageRating }}/5</div>
              <div class="stat-loading" *ngIf="statsLoading">
                <div class="spinner-border spinner-border-sm"></div>
              </div>
            </div>
            <div class="stat-label">Average Rating</div>
          </div>
        </div>
      </div>

      <!-- Total Distance -->
      <div class="stat-card stat-primary" role="group">
        <div class="stat-card-body">
          <div class="stat-content">
            <div class="stat-top">
              <div class="stat-icon">
                <i class="fas fa-road"></i>
              </div>
              <div class="stat-value" *ngIf="!statsLoading">{{ formatDistance(stats.totalDistance) }}</div>
              <div class="stat-loading" *ngIf="statsLoading">
                <div class="spinner-border spinner-border-sm"></div>
              </div>
            </div>
            <div class="stat-label">Total Distance</div>
          </div>
        </div>
      </div>

      <!-- Fuel Expense -->
      <div class="stat-card stat-danger" role="group">
        <div class="stat-card-body">
          <div class="stat-content">
            <div class="stat-top">
              <div class="stat-icon">
                <i class="fas fa-gas-pump"></i>
              </div>
              <div class="stat-value" *ngIf="!statsLoading">{{ formatCurrency(stats.fuelExpense) }}</div>
              <div class="stat-loading" *ngIf="statsLoading">
                <div class="spinner-border spinner-border-sm"></div>
              </div>
            </div>
            <div class="stat-label">Fuel Expense</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content: two-column layout (Quick Actions | Recent Activities) -->
  <div class="main-grid">
    <div class="main-left">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Quick Actions</h5>
        </div>
        <div class="card-body">
          <div class="quick-actions-grid">
            <div class="quick-action-item" *ngFor="let action of quickActions">
              <div class="quick-action-card" (click)="navigateTo(action.route)">
                <div class="action-icon" [class]="'text-' + action.color">
                  <i [class]="action.icon"></i>
                </div>
                <div class="action-content">
                  <h6 class="action-title">{{ action.title }}</h6>
                  <p class="action-description">{{ action.description }}</p>
                </div>
                <div class="action-arrow">
                  <i class="fas fa-chevron-right"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-right">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">Recent Activities</h5>
          <button class="btn btn-sm btn-outline-primary" (click)="viewAllTrips()">
            View All
          </button>
        </div>
        <div class="card-body">
          <!-- Loading State -->
          <div *ngIf="activitiesLoading" class="text-center py-3">
            <div class="spinner-border spinner-border-sm text-primary"></div>
            <p class="mt-2 text-muted small">Loading activities...</p>
          </div>

          <!-- Activities List -->
          <div *ngIf="!activitiesLoading" class="activities-list">
            <div 
              *ngFor="let activity of recentActivities" 
              class="activity-item"
              (click)="handleActivityClick(activity)">
              <div class="activity-icon" [class]="getActivityColor(activity.type)">
                <i [class]="getActivityIcon(activity.type)"></i>
              </div>
              <div class="activity-content">
                <h6 class="activity-title">{{ activity.title }}</h6>
                <p class="activity-description">{{ activity.description }}</p>
                <div class="activity-meta">
                  <span class="activity-time">{{ getTimeAgo(activity.timestamp) }}</span>
                  <span *ngIf="activity.status" [class]="getStatusBadgeClass(activity.status)">
                    {{ activity.status }}
                  </span>
                  <span *ngIf="activity.amount" class="activity-amount">
                    {{ formatCurrency(activity.amount) }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Empty State -->
            <div *ngIf="recentActivities.length === 0" class="text-center py-4">
              <i class="fas fa-history fa-2x text-muted mb-3"></i>
              <p class="text-muted">No recent activities</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="loading-spinner">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading dashboard...</p>
    </div>
  </div>
</div>