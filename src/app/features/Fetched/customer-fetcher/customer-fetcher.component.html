<div  class="position-relative">
  <div class="p-3">
    <h2 class="fw-bold text-primary mb-3">List Of Customers</h2>

    <div class="d-flex justify-content-between mb-2">
      <input
        type="text"
        class="form-control w-50"
        placeholder="Search by name, email, or phone"
        (input)="onQuickFilterChanged($event)"
      />

      <button class="btn btn-outline-primary btn-sm" (click)="refreshCustomers()">
        ðŸ”„ Refresh
      </button>
    </div>

    <ag-grid-angular
      class="ag-theme-alpine"
      style="width: 100%; height: 500px;"
      [rowData]="customers"
      [columnDefs]="gridOptions.columnDefs"
      [masterDetail]="true"
      [detailCellRendererParams]="gridOptions.detailCellRendererParams"
      [defaultColDef]="gridOptions.defaultColDef"
      [pagination]="true"
      [paginationPageSize]="10"
      (gridReady)="onGridReady($event)"
      (cellValueChanged)="onCellEdit($event)"
      [animateRows]="true"
      [isRowMaster]="gridOptions.isRowMaster"
      >
    </ag-grid-angular> 


    <!-- Profile Modal Overlay -->
    <div
      *ngIf="selectedCustomer"
      class="modal-backdrop-custom d-flex align-items-center justify-content-center"
    >
      <div class="card profile-modal shadow border border-info">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
          <strong>Customer Profile</strong>
          <button class="btn-close" (click)="selectedCustomer = null" aria-label="Close"></button>
        </div>

        <div class="card-body text-center" *ngIf="!isEditMode">
        <!-- Display profile info -->
        <img
          [src]="selectedCustomer?.profilePhoto || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'"
          class="rounded-circle mb-3"
          alt="Profile Image"
          style="width: 100px; height: 100px; object-fit: cover; border: 2px solid #17a2b8;"
        />
        <h5>{{ selectedCustomer?.firstName || '-' }} {{ selectedCustomer?.lastName || '-' }}</h5>
        <p><strong>Phone:</strong> {{ selectedCustomer?.phoneNumber || '-' }}</p>
        <p><strong>Email:</strong> {{ selectedCustomer?.email || '-' }}</p>
        <p><strong>City:</strong> {{ selectedCustomer?.profile?.address?.city || '-' }}</p>
        <p><strong>Status:</strong> {{ selectedCustomer?.accountStatus || '-' }}</p>
      </div>

      <div class="card-body text-start" *ngIf="isEditMode">
        <!-- Editable fields -->
        <div class="mb-2">
          <label>First Name</label>
          <input class="form-control" [(ngModel)]="editableCustomer.profile.firstName" />
        </div>
        <div class="mb-2">
          <label>Last Name</label>
          <input class="form-control" [(ngModel)]="editableCustomer.profile.lastName" />
        </div>
        <div class="mb-2">
          <label>Phone</label>
          <input class="form-control" [(ngModel)]="editableCustomer.profile.phoneNumber" />
        </div>
        <div class="mb-2">
          <label>Email</label>
          <input class="form-control" [(ngModel)]="editableCustomer.profile.email" />
        </div>
        <div class="mb-2">
          <label>City</label>
          <input class="form-control" [(ngModel)]="editableCustomer.profile.address.city" />
        </div>
        <div class="mb-2">
          <label>Status</label>
          <input class="form-control" [(ngModel)]="editableCustomer.accountStatus" />
        </div>
      </div>

        <div class="card-footer text-center">
          <button class="btn btn-secondary me-2" *ngIf="isEditMode" (click)="cancelEdit()">Cancel</button>
          <button class="btn btn-success me-2" *ngIf="isEditMode" (click)="saveEdit()">Save</button>
          <button class="btn btn-primary me-2" *ngIf="!isEditMode" (click)="startEdit()">Edit</button>
          <button class="btn btn-danger" (click)="deleteCustomer(selectedCustomer?.id)">Delete</button>
        </div>
      </div>


    </div>
    <!-- End of Profile Modal Overlay -->



  </div>
</div>
